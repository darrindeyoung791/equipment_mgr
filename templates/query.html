<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>设备查询</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <h1>设备查询</h1>

    <form id="query-form">
      <label for="device_name">设备名称:</label>
      <input
        type="text"
        id="device_name"
        name="device_name"
        required
      /><br /><br />

      <button type="submit">查询</button>
    </form>

    <table border="1">
      <thead>
        <tr>
          <th>设备ID</th>
          <th>设备名称</th>
          <th>型号</th>
          <th>购入时间</th>
          <th>价格</th>
          <th>状态</th>
          <th>所属实验室</th>
          <th>是否可借用</th>
        </tr>
      </thead>
      <tbody id="query-results">
        <!-- 查询结果将通过JavaScript动态加载 -->
      </tbody>
    </table>

    <script>
      document
        .getElementById("query-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const deviceName = document
            .getElementById("device_name")
            .value.trim();
          if (!deviceName) {
            alert("请输入设备名称！");
            return;
          }

          try {
            const response = await fetch(
              `/api/devices/query?device_name=${encodeURIComponent(deviceName)}` // 确保正确编码
            );
            const devices = await response.json();

            const resultsTable = document.getElementById("query-results");
            resultsTable.innerHTML = ""; // 清空表格内容

            if (devices.length === 0) {
              const row = document.createElement("tr");
              row.innerHTML = `<td colspan="8" style="text-align: center;">未找到相关设备</td>`;
              resultsTable.appendChild(row);
              return;
            }

            devices.forEach((device) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                        <td>${device.device_id}</td>
                        <td>${device.device_name}</td>
                        <td>${device.model}</td>
                        <td>${device.purchase_date}</td>
                        <td>${device.price}</td>
                        <td>${device.status}</td>
                        <td>${device.lab}</td>
                        <td>${device.can_borrow === 1 ? "是" : "否"}</td>
                    `;
              resultsTable.appendChild(row);
            });
          } catch (error) {
            console.error("查询失败:", error);
            alert("查询失败，请检查网络或联系管理员");
          }
        });
    </script>
  </body>
</html>
